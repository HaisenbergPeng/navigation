<?xml version="1.0"?>

<robot xmlns:xacro="http://www.ros.org/wiki/xacro" 
 	xmlns:sensor="http://playerstage.sourceforge.net/gazebo/xmlschema/#sensor"
    	xmlns:controller="http://playerstage.sourceforge.net/gazebo/xmlschema/#controller"
    	xmlns:interface="http://playerstage.sourceforge.net/gazebo/xmlschema/#interface"
	name="myRobot_xacro">


	<xacro:macro name="default_inertial" params="mass">
               <inertial>
                       <mass value="${mass}" />
                       <inertia ixx="0.1" ixy="0.0" ixz="0.0"
                                iyy="0.1" iyz="0.0"
                                izz="0.1" />
               </inertial>
	</xacro:macro>

	<link name="base_footprint">
   		<visual>
			<geometry>
      				<box size="0.001 0.001 0.001"/>
     			</geometry>
			<origin rpy="0 0 0" xyz="0 0 0"/>
			<material name="Green">
				<color rgba="0 1 0 1"/>
			</material>
   		</visual>
		
 	</link>
 
	<gazebo reference="base_footprint">
		<material>Gazebo/Green</material>
		<turnGravityOff>false</turnGravityOff>
	</gazebo>

	<joint name="base_footprint_joint" type="fixed">
		<origin xyz="-0.17 0 0" />
		<parent link="base_footprint" />
		<child link="base_link" />
	</joint>


	<link name="base_link">
   		<visual>
      			<origin xyz="0 0 0" rpy="0 0 0"/>
      			<geometry>
        			<mesh filename="package://myrobot_description/meshes/base_link.dae"/>
      			</geometry>
    		</visual>

		<collision>
			<origin xyz="0 0 0" rpy="0 0 0"/>
      			<geometry>
        			<mesh filename="package://myrobot_description/meshes/base_link.dae"/>
      			</geometry>
		</collision>
		<xacro:default_inertial mass="5.5"/>
 	</link>

	<joint name="body_to_base_link" type="fixed">
   		<parent link="base_link"/>
   		<child link="body_link"/>
   		<origin rpy="0 0 0" xyz="0 0 0.148"/>
 	</joint>

	<link name="body_link">
   		<visual>
     			<origin xyz="0 0 0" rpy="0 0 0"/>
      			<geometry>
        			<mesh filename="package://myrobot_description/meshes/body.dae"/>
      			</geometry>
		</visual>
		<collision>
			<origin xyz="0 0 0" rpy="0 0 0"/>
      			<geometry>
        			<mesh filename="package://myrobot_description/meshes/body.dae"/>
      			</geometry>
		</collision>
		<xacro:default_inertial mass="5.0"/>
 	</link>

 	<joint name="base_caster_support_joint" type="continuous">
            <origin xyz="-0.18 0 0.01" rpy="0 0 0" />
            <parent link="base_link" />
            <child link="base_caster_support_link"/> 
            <axis xyz="0 0 1" />
            <anchor xyz="0.01 0 0" />
            <limit effort="100" velocity="100" k_velocity="0" />
            <joint_properties damping="0.0" friction="0.0" />
        </joint>

        

        <link name="base_caster_support_link">
            <inertial>
                <mass value="0.1"/>
                <origin xyz="0 0 0" />
                <inertia ixx="0.01" ixy="0.0" ixz="0.0"
                         iyy="0.01" iyz="0.0"
                         izz="0.01" />
            </inertial>
            
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://myrobot_description/meshes/erratic_caster_support_link.dae"/>
                </geometry>
            </visual>
            
            <collision>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://myrobot_description/meshes/erratic_caster_support_link.dae"/>
                </geometry>
            </collision>
        </link>

        <joint name="caster_wheel_joint" type="continuous">
            <origin xyz="-0.025 0 -0.0469" rpy="0 0 0" />
            <parent link="base_caster_support_link" />
            <child link="caster_wheel_link" />       
            <axis xyz="0 1 0" />
            <anchor xyz="0 0 0" />
            <limit effort="100" velocity="100" k_velocity="0" />
            <joint_properties damping="0.0" friction="0.0" />
        </joint>

        

        <link name="caster_wheel_link">
            <inertial>
                <mass value="0.1" /> 
                <origin xyz="0 0 0" rpy="0 0 0" />
                <inertia  ixx="0.012411765597" ixy="-0.000711733678" ixz="0.00050272983"
                          iyy="0.015218160428" iyz="-0.000004273467"
                          izz="0.011763977943" />
            </inertial>
            
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://myrobot_description/meshes/erratic_caster_wheel_link.dae"/>
                </geometry>
                <material name="Black"/>
            </visual>
            
            <collision>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://myrobot_description/meshes/erratic_caster_wheel_link.dae"/>
                </geometry>
            </collision>
        </link>

        <gazebo reference="caster_wheel_link">
            <mu1 value="100.0" />
            <mu2 value="100.0" />
            <kp  value="1000000.0" />
            <kd  value="1.0" />
        </gazebo>

	 <joint name="wheel_0_joint" type="continuous">
   		<parent link="base_link"/>
   		<child link="left_wheel"/>
   		<origin rpy="0 0 1.5707" xyz="0.17 -0.21078 0"/>
   		<axis xyz="1 0 0" />
 	</joint>

	 

 	<link name="left_wheel">
   		<visual>
     			<origin xyz="0 0 0" rpy="0 0 0"/>
      			<geometry>
        			<mesh filename="package://myrobot_description/meshes/wheel.dae"/>
      			</geometry>
		</visual>
		<collision>
			<origin xyz="0 0 0" rpy="0 0 0"/>
      			<geometry>
        			<mesh filename="package://myrobot_description/meshes/wheel.dae"/>
      			</geometry>
		</collision>
		<xacro:default_inertial mass="0.5"/>
 	</link>

	<joint name="wheel_1_joint" type="continuous">
   		<parent link="base_link"/>
   		<child link="right_wheel"/>
   		<origin rpy="0 0 1.5707" xyz="0.17 0.21078 0"/>
   		<axis xyz="1 0 0" />
 	</joint>

 	

 	<link name="right_wheel">
   		<visual>
     			<origin xyz="0 0 0" rpy="0 0 0"/>
      			<geometry>
        			<mesh filename="package://myrobot_description/meshes/wheel.dae"/>
      			</geometry>
		</visual>
		<collision>
			<origin xyz="0 0 0" rpy="0 0 0"/>
      			<geometry>
        			<mesh filename="package://myrobot_description/meshes/wheel.dae"/>
      			</geometry>
		</collision>
		<xacro:default_inertial mass="0.5"/>
 	</link>



  <!-- Camera joint -->
  <joint name="camera_joint" type="fixed">
    <axis xyz="0 1 0" />
    <origin xyz="0.22 0 0.009" rpy="0 0 0"/>
    <parent link="base_link"/>
    <child link="camera_link"/>
  </joint>

  <!-- Camera -->
  <link name="camera_link">
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
	<box size="0.05 0.05 0.08"/>
      </geometry>
    </collision>

    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
	<box size="0.05 0.05 0.08"/>
      </geometry>
      <material name="red">
	<color rgba="1 0 0 1"/>
      </material>
    </visual>

    <inertial>
      <mass value="1e-5" />
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia ixx="1e-6" ixy="0" ixz="0" iyy="1e-6" iyz="0" izz="1e-6" />
    </inertial>
  </link>



  
<!--3D laser-->
<!--<origin xyz="0.4 0.0 0.0" rpy="0 0 0"/> -->
<joint name="laser" type="fixed">
    <origin xyz="0.4 0.0 0.0" rpy="0 0 0"/>       
    <parent link="base_link"/>
    <axis xyz="0 1 0" />
    <child link="laser"/>
  </joint>

  <link name="laser">
    <collision>
      <origin xyz="0 0 0.029335" rpy="0 0 0"/>
      <geometry>
	<!-- <radius>.04267</radius>
            <length>.05867</length>-->
         <cylinder length="0.5" radius="0.04267"/>
      </geometry>
    </collision>

    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://myrobot_description/meshes/velodyne_base.dae"/>
      </geometry>
	
    </visual>

    <inertial>
      <mass value="1.2" />
      <!--origin xyz="0 0 0" rpy="0 0 0"/-->
      <inertia ixx="0.001087473" ixy="0" ixz="0" iyy="0.001087473" iyz="0" izz="0.001092437" />
    </inertial>
  </link>

 


 <!-- Kinect joint -->
  <joint name="kinect_joint" type="fixed">
    <origin xyz="0.2 0 0.3" rpy="0 0.1745 0"/>    <parent link="base_link"/>                 <!-- z_top 1.374-->
    <axis xyz="0 1 0" />
    <child link="kinect_link"/>
  </joint>

 <!-- Kinect -->
  <link name="kinect_link">
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
	<box size="0.1 0.1 0.1"/>
      </geometry>
    </collision>

    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://myrobot_description/meshes/kinect.dae"/>
      </geometry>
    </visual>

    <inertial>
      <mass value="1e-5" />
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia ixx="1e-6" ixy="0" ixz="0" iyy="1e-6" iyz="0" izz="1e-6" />
    </inertial>
  </link>


<!--The following is gazebo part-->

  <!-- materials -->
  <gazebo reference="base_link">
    <material>Gazebo/Orange</material>
  </gazebo>

  <gazebo reference="body_link">
    <material>Gazebo/Orange</material>
  </gazebo>

 <gazebo reference="left_wheel">
        <material>Gazebo/Black</material>
 </gazebo>

 <gazebo reference="right_wheel">
        <material>Gazebo/Black</material>
 </gazebo>

  <gazebo reference="caster_wheel_link">
    <material>Gazebo/Black</material>
  </gazebo>


  <!-- ros_control plugin -->
  <gazebo>
    <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
      <robotNamespace>/robot</robotNamespace>
	
    </plugin>
  </gazebo>

 
  <!-- Drive controller -->
<gazebo>
  <plugin name="differential_drive_controller" filename="libgazebo_ros_diff_drive.so">
    <alwaysOn>true</alwaysOn>
    <updateRate>100.0</updateRate>
    <robotNamespace></robotNamespace>
    <leftJoint>wheel_0_joint</leftJoint>
    <rightJoint>wheel_1_joint</rightJoint>
    <wheelSeparation>0.43584</wheelSeparation>
    <wheelDiameter>0.15</wheelDiameter>
    <torque>20</torque>
    <commandTopic>cmd_vel</commandTopic>
    <odometryTopic>odom</odometryTopic>
    <odometryFrame>odom</odometryFrame> 
    <robotBaseFrame>base_footprint</robotBaseFrame>
  </plugin>
</gazebo>


  <!-- camera_link -->
  <gazebo reference="camera_link">
    <mu1>0.2</mu1>
    <mu2>0.2</mu2>
    <material>Gazebo/Red</material>
  </gazebo>

  <!-- camera -->
  <gazebo reference="camera_link">
    <sensor type="camera" name="camera1">
      <update_rate>30.0</update_rate>
      <camera name="head">
        <horizontal_fov>1.3962634</horizontal_fov>
        <image>
          <width>800</width>
          <height>800</height>
          <format>R8G8B8</format>
        </image>
        <clip>
          <near>0.02</near>
          <far>300</far>
        </clip>
        <noise>
          <type>gaussian</type>
          <!-- Noise is sampled independently per pixel on each frame.  
               That pixel's noise value is added to each of its color
               channels, which at that point lie in the range [0,1]. -->
          <mean>0.0</mean>
          <stddev>0.007</stddev>
        </noise>
      </camera>
      <plugin name="camera_controller" filename="libgazebo_ros_camera.so">
        <alwaysOn>true</alwaysOn>
        <updateRate>0.0</updateRate>
        <cameraName>robot/camera1</cameraName>
        <imageTopicName>image_raw</imageTopicName>
        <cameraInfoTopicName>camera_info</cameraInfoTopicName>
        <frameName>camera_link</frameName>
        <hackBaseline>0.07</hackBaseline>
        <distortionK1>0.0</distortionK1>
        <distortionK2>0.0</distortionK2>
        <distortionK3>0.0</distortionK3>
        <distortionT1>0.0</distortionT1>
        <distortionT2>0.0</distortionT2>
      </plugin>
    </sensor>
  </gazebo>  

  

<!-- 3D laser -->


  <!-- kinect -->
 <gazebo reference="kinect_link">
    <sensor type="depth" name="depth_camera">       
        <always_on>true</always_on>
        <visualize>true</visualize>             
        <camera>
            <horizontal_fov>1.047</horizontal_fov>  
            <image>
                <width>640</width>
                <height>480</height>
                <format>R8G8B8</format>
            </image>
            <depth_camera>

            </depth_camera>
            <clip>
                <near>0.1</near>
                <far>20</far>
            </clip>
        </camera>
        <plugin name="depth_camera_controller" filename="libgazebo_ros_depth_camera.so">
            <alwaysOn>true</alwaysOn>
            <updateRate>10.0</updateRate>
            <cameraName>camera</cameraName>
            <frameName>kinect_link</frameName>                   
            <imageTopicName>rgb/image_raw</imageTopicName>
            <depthImageTopicName>depth/image_raw</depthImageTopicName>
            <pointCloudTopicName>depth/points</pointCloudTopicName>
            <cameraInfoTopicName>rgb/camera_info</cameraInfoTopicName>              
            <depthImageCameraInfoTopicName>depth/camera_info</depthImageCameraInfoTopicName>            
            <pointCloudCutoff>0.4</pointCloudCutoff>                
                <hackBaseline>0.07</hackBaseline>
                <distortionK1>0.0</distortionK1>
                <distortionK2>0.0</distortionK2>
                <distortionK3>0.0</distortionK3>
                <distortionT1>0.0</distortionT1>
                <distortionT2>0.0</distortionT2>
            <CxPrime>0.0</CxPrime>
            <Cx>0.0</Cx>
            <Cy>0.0</Cy>
            <focalLength>0.0</focalLength>
            </plugin>
    </sensor>
</gazebo>

</robot>
