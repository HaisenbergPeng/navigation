before_script:
##设置环境变量
  - export PATH=$PATH 

## 定义有哪些stages 
stages:
  - analysis
  - build
  - test
  - deploy
  
sonarqube-check:
  image: 
    name: sonarsource/sonar-scanner-cli:latest
    entrypoint: [""]
  variables:
    SONAR_USER_HOME: "${CI_PROJECT_DIR}/.sonar"  # Defines the location of the analysis task cache
    GIT_DEPTH: "0"  # Tells git to fetch all the branches of the project, required by the analysis task
  cache:
    key: "${CI_JOB_NAME}"
    paths:
      - .sonar/cache
  script: 
    - sonar-scanner -Dsonar.projectKey=chuan.cao_laserslam_AYHsaJRcKtrs6qlHkR4P -Dsonar.sources=. -Dsonar.host.url=http://202.120.40.153:9001 -Dsonar.login=04964456d15a04e097378f671755537644ac4548
  ##only:
  ##  - master # or the name of your main branch
  ##  - /^iteration\/*$/
  ##  - branches
  ##  - merge_requests
  rules:
    - if: '$CI_MERGE_REQUEST_TARGET_BRANCH_NAME == "master"'
      when: always
    - if: '$VAR == "recheck"' 
      when: manual
    - when: on_success
  allow_failure: false

